---
title: P6478
date: 2021/12/3
description: 　
---

给定一个 $n=2m$ 个节点的树，其中有 $m$ 个白点， $m$ 个黑点。

现在要将黑白两点两两配对，对于 $k=0,1,...,m$ ，求恰好有 $k$ 对点存在祖先后代关系的方案数，对 $998244353$ 取模。

$1\leq n\leq 5000$

设 $f_i$ 为 $k=i$ 时的答案，即恰好有 $i$ 对点存在祖先后代关系的方案数 。

设 $g_i$ 为钦定 $i$ 对点存在祖先后代关系，其它点任意的方案数。

容易发现：
$$
g_k=\sum_{i=k}^{n}{f_i{i \choose k}}
$$
根据二项式反演：
$$
f_k=\sum_{i=k}^{n}{(-1)^{i-k}g_i{i\choose k}}
$$
也就是说如果求出 $g_i$ 就可以 $O(n^2)$ 算出 $f_i$ 。

设 $dp(u,i)$ 表示考虑 $u$ 的子树中选 $i$ 对存在祖先后代关系的点的方案数。

转移时先不考虑 $u$ 的配对情况有：
$$
dp(u,i)=\sum_{c_1+c_2+...+c_k}{\prod_{x=1}^{k}{dp(v_x,c_x)}}
$$
$c_i$ 为第 $i$ 个儿子中存在祖先后代关系的点的数量，这是经典的背包转移。

再考虑 $u$ 的配对情况，假设 $u$ 是白点，$u$ 的子树中有 $cnt$ 个黑点，转移为：
$$
dp(u,i+1)\leftarrow dp(u,i)\times (cnt-i)
$$
则 $g_i=dp(1,i)\times(m-k)!$ ，时间复杂度 $O(n^2)$ 。