---
title: CF1609G
date: 2021/12/3
description: 　
---

给一个长度为 $n$ 的序列 $a$ 和一个长度为 $m$ 的序列 $b$ ，两个数组均满足差分数组单增。现在 $q$ 组操作：

+ 操作一：对 $a$ 长度为 $k$ 的后缀加上等差数列 $d,2\times d,3\times d,...,k\times d$ 。
+ 操作二：对 $b$ 长度为 $k$ 的后缀加上等差数列 $d,2\times d,3\times d,...,k\times d$ 。

在每组操作完后问，如果构造一个 $n\times m$ 的网格图，其中 $(x,y)$ 的权值是 $a_x+b_y$ ，那么从 $(1,1)$ 走到 $(n,m)$ 的代价最小是多少？代价的定义是路径上所有权值之和。

$2\leq n\leq 100,2\leq m\leq 10^5,1\leq q\leq 10^5.1\leq a_i,b_i\leq 10^{12}$

假设从 $(1,1)$ 到 $(n,m)$ 的路径上的权值依次记为 $c_1,c_2,...,c_{n+m-1}$ ，考虑如何最小化 $\sum c_i$ 。

设 $a,b,c$ 的差分数组分别为 $a',b',c'$ ，则可以发现，$c'$ 中的元素要么属于 $a'$ 要么属于 $b'$ （取决于这一步向哪边走），具体来说，$c'$ 满足：

+ 对于任意 $i$ ，$c'_i\in a'$ 或 $c_i'\in b'$
+ 对于任意 $i,j$ ，若 $c'_i\in a',c'_j\in a'$ ，则 $c'_i<c'_j$ （因为 $a'$ 单调）
+ 对于任意 $i,j$ ，若 $c'_i\in b',c'_j\in b'$ ，则 $c'_i<c'_j$ （因为 $b'$ 单调）

注意到：
$$
\sum_{i=1}^{n+m-1}{c_i}=c_1\times(n+m-1)+\sum_{i=1}^{n+m-2}{c'_i\times(n+m-1-i)}
$$
要使这个式子最小是一个经典问题，当 $c_i'$ 单增时取到最小值。容易发现这个情况是可以取到的，只需将 $a'$ 和 $b'$ 归并起来即可。

由于 $n\leq 100$ ，我们考虑每次将 $a'$ 中的数暴力插入 $b'$ 中（这里并不会真的插入，只是计算插入的贡献）。那就意味着我们需要用一个数据结构来维护 $b'$ ，支持：

+ 后缀加 $x$ 。
+ 查询某个后缀的和。
+ 找到第一个小于 $x$ 的位置。

显然线段树可以在 $\log$ 的时间支持以上所有操作，时间复杂度 $q\times n\times\log(m)$ 。 