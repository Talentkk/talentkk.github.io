---
title: CF138E
date: 2021/12/12
description: 　
---

给出 $k$ 个限制 $(o_i,l_i,r_i)$ ，对于一个字符串，满足第 $i$ 个限制当且仅当，字符串中出现的字符 $o_i$ 的数量在 $l_i$ 和 $r_i$ 之间。再给出字符串 $S$  以及 $L,R$ ，问 $S$ 有多少个子串，使得这个子串满足的限制数量在 $[L,R]$ 之间。

$1\leq |S|\leq 10^5,0\leq L\leq R\leq k\leq 500$

考虑 $k=1$ 时。我们枚举子串的右端点 $r$ ，显然，对于符合限制的左端点 $l$ 一定是一段区间。当右端点 $r$ 向右移动时，这个合法区间的两个端点也会向右移动，比如一次 $r\rightarrow r+1$ 的过程中，区间从 $[a,b]$ 变成了 $[a',b']$ ，则我们直接暴力把 $[a,a'-1]$ 变为不合法，$[b+1,b']$ 变为合法，并可以方便地维护当前符合条件（指满足的限制数量在 $[L,R]$ 之间）的左端点的数量。注意到每个点都只会变合法一次，变不合法一次，所以复杂度是 $O(n)$ 的。

回到原问题，其实也是类似的。我们对于每一个限制都维护，符合这个限制的左端点构成的区间，并在区间变化时暴力修改，维护当前符合条件（指满足的限制数量在 $[L,R]$ 之间）的左端点的数量。时间复杂度 $O(n\times k)$ 。