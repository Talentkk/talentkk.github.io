---
title: CF1511F
date: 2022/1/13
description: 　
---

## CF1511F

给出 $n$ 个长度不超过 $5$ 的字符串，定义一种方案为：

+ 写出一个长度为 $m$ 的字符串 $T$
+ 存在一种划分方式，使得可以把这个字符串划分成若干个子段，满足每个子段都是给出 $n$ 个串中的一个。
+ 存在第二种划分方式。

注意这里两种划分方式可以相同。

对于两个方案，它们不同当且仅当 $T$ 不同或第一种划分方式不同或第二种划分方式不同。

求方案数对 $998244353$ 取模。

$1\leq n\leq 8,1\leq m\leq 10^9$

把给出的串插入到 `trie` 上，朴素的 $dp$ 为：设 $dp(i,j,k)$ 为考虑 $T$ 的前 $i$ 个字符，第一种划分方式对应的点在 $j$ ，第二种划分方式对应的点在 $k$ 的方案数。由于 $i$ 是 $10^9$ ，可以考虑用矩阵乘法优化，但是 $(j,k)$ 的状态数有 $1600$ ，无法通过。

考虑优化状态数，容易发现，如果写出从根到 $j$ 的串 $s_j$ 和从根到 $k$ 的串 $s_k$ ，那么必然有 $s_j$ 是 $s_k$ 的后缀或 $s_k$ 是 $s_j$ 的后缀。我们可以用 $bfs$ 找出这样的状态数，可以发现，这样的状态数是很少的，足以通过此题。

