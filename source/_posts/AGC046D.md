title: AGC046D
date: 2021/12/23
description: 　
---

给一个 $01$ 串 $s$ ，求有多少个串 $s$ 可以形成的。

对 $s$ 的操作规则如下，你可以对 $s$ 执行 $0$ 次或多次操作：

+ 移走 $s$ 开头的两个字符，删掉其中的一个，将另一个重新插入 $s$ 的任意位置。这个操作可以执行只有当目前 $|s|\geq 2$ 。

答案对 $998244353$ 取模。

$1\leq |s|\leq 300$

考虑给出一个串 $t$ ，判断是否能够 $s\to t$ 。

容易发现 $s$ 被改变的一定是一段前缀，不变的是一段后缀。所以我们将 $s$ 的反串贪心地在 $t$ 的反串中匹配，假设最终 $s_n,s_{n-1},...,s_{n-k+1}$ 与 $t_{p_1},t_{p_2},...,t_{p_k}$ 匹配。对于 $t$ 中没有被匹配到的字符就只能通过插入操作得到。容易证明这样检验一定不劣。

为了计算方案不重不漏，我们把任意一个串 $T$ 放在 $p_k$ 这个地方计算贡献。

设 $g(i,j,k)$ 表示有多少个串 $T$ ，满足当前匹配到了 $s_i$ ，需要额外插入 $j$ 个 $0$ 和 $k$ 个 $1$ 。这样的 $(i,j,k)$ 是唯一对应一个串 $T$ 的。转移时枚举在 $T$ 的前面加入 $0$ 或 $1$ 即可。

但并不是所有 $(i,j,k)$ 都是合法的，前提条件是我们可以在保证 $s_{i...n}$ 不变的情况下，拿出 $j$ 个 $0$ 和 $k$ 个 $1$ 插进去。

于是设 $f(i,j,k)$ 表示在只变动 $s_{1...i}$ 的情况下，是否能拿出 $j$ 个 $0$ 和 $k$ 个 $1$ 。注意这里是 "只变动 $s_{1...i}$ " ，$s_{i+1...n}$ 不是不能被操作，而是要保证操作后它们的值不变，转移比较显然。

最后答案就是：
$$
\sum_{i}{\sum_{j}{\sum_{k}{g(i,j,k)\times f(i-1,j,k)}}}
$$
时间复杂度 $O(n^3)$ 。