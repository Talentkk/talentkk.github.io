---
title: 2.22做题
date: 2023/2/22
description: 　
---

# 2.22

## P8854

> $n$ 个二维向量 $(a_i,b_i)$ 。一个人一开始在 $(0,0)$ ，每步可以从 $(x,y)$ 走到 $(x+a_i,y+b_i)$ ，问他能不能走到平面上所有的整点。
> 
> $1\leq n,|a_i|,|b_i| \leq 100,T\leq 10000$

一个 $O(Tn\log n)$ 的做法。

首先如果每个向量既可以加，又可以减会怎么样。显然如果这种情况下不合法，原问题也不合法。

考虑怎么做这个问题，一个十分经典的方法是每次拿两个向量出来辗转相减，最终只会剩下两个有用的向量，并当它们分别是 $(1,0)$ 和 $(0,1)$ 时才有解。

然后发现只要再满足以下条件即可：将所有向量按照极角排序后，相邻向量夹角小于 $\pi$ 。

因为如果不满足条件，那么所有向量都会在某条直线的一侧，显然不合法。

如果满足条件，那么一定可以找到一个序列 $c_1,c_2,...,c_n$ ，满足：

$$
\sum_{i}{c_i(a_i,b_i)}=(0,0),c_i>0
$$

由于前面已经说明存在一组系数为整数的解，那么我们不断加上这组和为 $0$ 的向量直到所有数的系数都为正数即可。

## AGC035F

> 现在你有一个 $n\times m$ 的网格，你会按顺序进行做如下操作：
> 
> - 把所有格子中的数都赋为 $0$ 。
> - 对每一行选一个 $k_i$ $(0\leq k_i\leq m)$ ，并把这一行最左边的 $k_i$ 个格子 $+1$ 。
> - 对每一列选一个 $l_i$ $(0\leq l_i\leq n)$ , 并把这一列最上面的 $l_i$ 个格子 $+1$ 。
> 
> 经过这些操作后，你可以得到一个只包含 $0$，$1$ , $2$ 的网格。请你求出，在所有可能的操作下，可以得到多少本质不同的网格。
> 
> 两个网格被称为本质不同的，当且仅当存在至少一个位置，两个网格对应位置上的数不同。
> 
> 输出答案对 $998244353$ 取模的结果。
> 
> 数据范围：$n,m\leq 5\times 10^5$ 。

神仙结论。

结论证明：www.luogu.com.cn/blog/MasterYi/solution-at5143

计数：www.luogu.com.cn/blog/yijan/solution-at5143

## AGC034F

> 给定 $n$ 和一个长度为 $2^n$ 的数组 $A$ (从 $0$ 标号)。
> 
> 有一个初始为 $0$ 的变量 $x$ . 不断操作, 每次操作以 $\frac {A_i}{\sum_{j=0}^{2^n-1} A_j}$ 的概率将 $x$ 变成 $x\ xor\ i$ 。
> 
> 对于所有 $i\in[0,2^n)$ , 求出 $x$ 第一次变成 $i$ 的期望操作次数。
> 
> $n\leqslant 18, 1\leqslant A\leqslant 1000$

生成函数遇到异或卷积时，用 FWT 来推式子。

## P5326

> 给定 $n,s$ 和一个长度为 $n$ 的数组 $p$ (从 $0$ 标号)。
> 
> 有一个初始为 $0$ 的变量 $x$ ，不断操作，每次有 $\frac{p_i}{\sum_{j} {p_j}}$ 的概率将 $x$ 变成 $x\ xor\ 2^i$ 。
> 
> 求把 $x$ 变成 $s$ 的期望次数，对 $998244353$ 取模。
> 
> $n\leq 100,\sum p_i\leq5\times 10^4$

和上题一样的套路，但最终推出来的结论更为精妙。

## AGC028F

> 给定一张 $N$ 行 $N$ 列的网格图，每一个格子有两种情况：有障碍物，或者是空的并且写着一个 $1\sim 9$ 的整数。
> 
> 称格子 $Y$ 能被格子 $X$ 到达当且仅当以下条件均被满足：
> 
> - 单元格 $X$ 和 $Y$ 不同。
> - 单元格 $X$ 和 $Y$ 均为空。
> - 通过反复向右或向下移动到相邻的空单元格，可以从单元格 $X$ 到达单元格 $Y$。
> 
> 求出 $\sum A_XA_Y$ ，其中 $X$ 可以到达 $Y$ ，$A$ 代表格子上的数。
> 
> $1\leq n\leq 500$

路径问题求出边界后往往有很强的性质。

## AGC032F

> 有一个圆比萨要切成 $n$ 块，每刀是一条半径。由于你技术不好，你只会独立均匀地随机 $n$ 个角度来切。切完之后你会取出圆上相邻的若干块吃掉。
> 
> 设这个比萨的面积为 $1$ ，你要找到面积最接近 $\frac{1}{3}$ 的这若干块，即设你取出的面积为 $x$，你想要找到 $\lvert x-\frac{1}{3} \rvert$ 最小的一种方案。求这个最小值的期望，对 $10^9+7$ 取模。
> 
> $2\leq n\le 10^6$

神仙计数

## [NOIP2022] 喵了个喵

> 小 E 喜欢上了一款叫做《喵了个喵》的游戏。这个游戏有一个牌堆和 $n$ 个可以从栈底删除元素的栈，任务是要通过游戏规则将所有的卡牌消去。开始时牌堆中有 $m$ 张卡牌，从上到下的图案分别是 $a_1, a_2,\dots, a_m$。所有的卡牌一共有 $k$ 种图案，从 $1$ 到 $k$ 编号。牌堆中每一种图案的卡牌都有偶数张。开始时所有的栈都是空的。这个游戏有两种操作：
> 
> - 选择一个栈，将牌堆顶上的卡牌放入栈的顶部。如果这么操作后，这个栈最上方的两张牌有相同的图案，则会自动将这两张牌消去。
> - 选择两个不同的栈，如果这两个栈栈**底**的卡牌有相同的图案，则可以将这两张牌消去，原来在栈底上方的卡牌会成为新的栈底。如果不同，则什么也不会做。
> 
> 这个游戏一共有 $T$ 关，小 E 一直无法通关。请你帮小 E 设计一下游戏方案，即对于游戏的每一关，给出相应的操作序列使得小 E 可以把所有的卡牌消去。
> 
> 设 $S$ 为所有 $T$ 组数据中 $m$ 的总和。
> 
> 对于所有数据，保证 $S \leq 2 \times 10^6$，$1 \leq n \leq 300$，$1 \leq a_i \leq k$ ，$k\leq 2n-1$。

猜结论+构造

## [NOIP2022] 比赛

> 两个长度为 $n$ 的序列 $a,b$ ，计 $ma(l,r),mb(l,r)$ 分别为 $a,b$ 的区间最大值。 $q$ 组询问 $(l,r)$ ，要求输出：
> 
> $$
> \sum_{i=l}^{r}\sum_{j=i}^{r}{ma(i,j)\times mb(i,j)}
> $$
> 
> 答案对 $2^{64}$ 取模。
> 
> $1\leq n,q\leq 2.5\times 10^5,1\leq a_i,b_i\leq n$

维护历史版本和的线段树。

这里记录一个比较好理解的维护方式：

- 设 $a_i$ 是原序列，$b_i$ 是它的历史版本和，$t$ 是当前进行的操作数，并维护 $c_i=b_i-a_i\times t$ 。考虑一个新的区间加操作 $(l,r,x)$ 加入后（第 $t+1$ 个），若操作区间不覆盖 $i$ ，则 $c_i$ 不改变；若操作区间覆盖 $i$ ，则 $c_i\to c_i-t\times x$ 。这样问题就变成了简单的区间加操作。我们通过维护好维护的 $a,c$ 间接得到了不好维护的 $b$ 。

## [ICPC2017 WF]Money for Nothing

> 一共有 $m$ 个生产商和 $n$ 个消费商。第 $i$ 个生产商从第 $d_i$ 个时刻开始销售物品，每个物品卖 $p_i$ 元。第 $i$ 个消费商从第 $1$ 个时刻开始需要消费，他的消费欲望一直到第 $e_i-1$ 的时刻，每个物品出价 $q_i$ 元。你作为中间商，只能与一间生产商和一间消费商签订合约，可以选择在生产商那里买下一些物品，也可以选择卖向消费商，你的目的就是赚中间的差价。
> 
> 你想知道最多能赚到多少差价。
> 
> $1 \le m,n \le 5\times 10^5$，$1 \le p_i,d_i,q_i,e_i \le 10^9$。

神仙的决策单调性（很难想到）。

## CF958C3

> 有一个包含 $n$ 个正整数的数列，将这个数列分成 $k$ 个非空段，每段的价值为这段的所有数总和 $mod$ $p$，你需要使 $k$ 段价值总和最小，请求出这个最小值。
> 
> $1\leq n\leq 5\times 10^5,2\leq k\leq \min(100,n),2\leq p\leq 100$

从 dp 状态本身定义上得到的优化。

## [JOISC2020] 星座 3

> 大小为 $n\times n$ 的网格，初始每个网格都为空。长度为 $n$ 的序列 $a_i$ ，表示第 $i$ 列的最靠下的 $a_i$ 个格子上都有一艘船。另外还有 $m$ 个三元组 $(x_i,y_i,c_i)$ ，表示 $(x_i,y_i)$ 上存在一颗价值为 $c_i$ 的星星。
> 
> 定义一个矩形是星座当且仅当：
> 
> 1. 矩形中不存在船。
>   
> 2. 矩形中至少包含两颗星星。
>   
> 
> 现在要删去代价和最小的星星，使得不存在星座。
> 
> $1\leq n,m\leq 2\times 10^5,1\leq c_i\leq 10^9,a_{x_i}<y_i$

记录一个稍微不一样的做法，我们直接求留下的星星的最大代价和。

首先建出笛卡尔树，笛卡尔树中的每个节点都代表了一个矩形（不包含船），每颗星星恰好属于一个矩形。

那么显然一个矩形中只能留下一颗星星，同时选了一颗星星以后也有可能会影响到其它的矩形。

设 $dp_u$ 表示考虑 $u$ 子树内的所有星星，能获得的最大代价。转移分两种：

- 当前矩形内不选择星星：由于 $u$ 的两个子树内决策互不影响，故直接对 $u$ 的儿子求和就好了。
  
- 当前矩形内选择星星：枚举选择了 $x$ 。那么在 $u$ 的子树中若存在一个点的矩形满足，它在水平方向上包含了枚举的这颗星星，则这个矩形内的所有星星都不能选了。我们把所有这样的节点删去后，剩下森林的根节点 $dp$ 值的和就是在选择了 $x$ 后还能选择星星的最大值。然后考虑优化这个过程，对于节点 $u$ 将 $dp_u-\sum_{v}{dp_v}$ 插入 BIT 即可。
  

时间复杂度 $O(n\log n)$ 。

## AGC032E

> 令 $M$ 为一正整数。
> 
> 给出 $2 N$ 个整数 $a_1, a_2, \ldots , a_{2N}$，满足 $0 \le a_i < M$。
> 
> 你需要把这 $2 N$ 个整数分成 $N$ 对，每一对 $(x, y)$ 的权值为 $(x + y) \bmod M$。
> 
> 令一种分配方案的权值为每一对的权值的最大值，请问权值最小的分配方案的权值为多少？
> 
> $1 \le N \le {10}^5$，$1 \le M \le {10}^9$，$0 \le a_i < M$。

相交一定不优。

## AGC010E

> 有一个 $n$ 个数组成的序列 $a_i$。
> 
> 高桥君会把整个序列任意排列，然后青木君可以进行任意次操作，每次选择两个相邻的互质的数交换位置。
> 
> 高桥君希望最终序列的字典序尽量小，而青木君希望字典序尽量大。求最终序列。
> 
> $1\leq n\leq 2000,1\leq a_i\leq 10^8$

从充分条件分析

## AGC034E

> 给你一颗 $n$ 个节点的树，并用二进制串告诉你哪些节点上有棋子（恰好一颗）。
> 
> 可以进行若干次操作，每次操作可以将两颗距离至少为 $2$ 的棋子向中间移动一步。
> 
> 问能否通过若干次操作使得所有的棋子都在一个点上，如果能，输出最小操作次数，如果不能，输出 $-1$ 。
> 
> $2 \leq n\leq 2000$

棋子在操作的过程中会到达若干状态，可以把这些状态分别视作一个棋子。

## AGC034D

> 在一个二维坐标系内，点 $(RX_i,RY_i)$ 上有 $RC_i$ 个红球，点 $(BX_i,BY_i)$ 上有 $BC_i$ 个蓝球，且保证 $\sum_{i=1}^{n}RC_i=\sum_{i=1}^{n}BC_i$。
> 
> 现在要你将这些红球蓝球一一配对，配对的价值为两球所在点之间的曼哈顿距离，请你求出配对完它们的最大价值和。
> 
> $n\leq 1000,1\leq rc,ry\leq 10$

曼哈顿距离等价于拆掉绝对值后取 max 。

## AGC037E

> 给定一个长度为 $n$ 的只包含小写字母的字符串 $s$ 和正整数 $k$ , 求进行 $k$ 次如下操作后：
> 
> 将 $s$ 和 $s$ 的翻转拼接($s$ 在前)得到 $t$ , 从 $t$ 中截取长度为 $n$ 的子串作为新的 $s$.
> 
> 字典序最小的 $s$ 。
> 
> $n\leqslant 5000,k\leqslant 10^9$

结论

## AGC038E

> 有一个随机数生成器，生成 $[0,n-1]$ 之间的整数，其中生成 $i$ 的概率为 $\frac{A_i}{S}$，其中，$S=\sum A_i$。
> 
> 这个随机数生成器不断生成随机数，当 $\forall i\in[0,n-1]$，$i$ 至少出现了 $B_i$ 次时，停止生成，否则继续生成。
> 
> 求期望生成随机数的次数，输出答案对 $998244353$ 取模的结果。
> 
> $A_i,B_i\geq 1$，$\sum A_i,\sum B_i,n\leq 400$。

神仙计数题。

min-max 容斥。

要对每种情况下的状态数求和，可以对每个状态分别计数。

## AGC018F

> 给定两棵都是 $N$ 个节点的有根树 $A,B$ ，节点均从 $1...N$ 标号。
> 
> 我们需要给每个标号定一个权值，使在两棵树上均满足任意节点子树权值和为 $1$ 或 $-1$ 。
> 
> 输出任意一种解，需要判断无解。
> $N\leq 10^5$

从无解的条件出发，神仙欧拉回路构造。

## CF1787I

> 长度为 $n$ 的序列，求所有子区间的最大子段和的和。
> 
> $1\leq n\leq 10^6$

cdq分治+决策单调性

## [ICPC2014 WF]Surveillance

> 给定一个长度为 $n$ 的环，有 $k$ 个区域被覆盖，求最小的满足环被完全覆盖的区域数量。
> 
> $n,k\leq 10^6$

倍增优化贪心。

## CF251D

> 给你$N$ 个数$a_i$ ,要求把这些数分成两堆
> 
> 使第一堆的异或和加第二堆的异或和最大
> 
> 在满足这个条件下使第一堆的异或和最小,输出方案。
> 
> $N\le10^5,a_i\le10^{18}$

线性基。

## ARC153D

> 定义 $f(x)$ 为其十进制意义下各位数字之和，比如 $f(1)=1,f(123)=6$。
> 
> 给定长度为 $n$ 的序列 $A$，请找到一个非负整数 $x$ 使得 $\sum\limits_{i=1}^nf(A_i+x)$ 最小，并输出这个最小值。
> 
> $1\leq n\leq 2\times10^5,1\leq A_i<10^9$

数位 dp 。

## AGC036E

> 给你一个长度为 $n$ 的仅包含ABC三种字母的字符串 $s$ ，现在要你输出一个满足下列要求的最长的 $s$ 的子序列:
> 
> - ABC三种字符的出现次数相同。
> - 子序列中相邻两个字符不能相同。
> 
> 如果有多组解，输出任意一组即可。
> 
> 数据范围：$|s|\leq 10^6$。

贪心。

## AGC035E

> 在黑板上写有$-10^{18}$到$10^{18}$中的所有整数，每次你可以选中一个$[ 1 , N]$中还在黑板上的整数$x$，把它擦去并补写上$x − 2$ 与 $x + K$（如果原来不存在的话）。你可以进行这个操作任意次（可以不进行），求最终黑板上数字的可能状态有多少种，答案对$M$取模。
> 
> $1\leq K \leq N \leq 150 , 10^8\leq M\leq 10^9$

性质+dp

## CF505E

> 给定 $n$ 个数 $h_{1 \dots n}$。
> 
> 你需要进行 $m$ 轮操作，每轮操作为 $k$ 次修改，每次修改可以选择一个数 $h_i$ 修改为 $\max(h_i - p, 0)$。
> 
> 每轮操作后每个 $h_i$ 将会被修改为 $h_i + a_i$。
> 
> 你需要最小化最终 $h_{1 \dots n}$ 中的最大值。
> 
> $n \le 10^5$，$m \le 5 \times 10^3$，$k \le 10$。

倒序后贪心地用堆维护。

## CF1610F

> 给定一张含 $n$ 个点 $m$ 条边的无向图，结点编号为 $1$ 到 $n$。
> 
> 每条边有边权 $w_i$，而 $w_i$ 只能等于 $1$ 或 $2$。蓝想要给每条边定向，使得图尽可能的可爱。
> 
> 图的可爱程度定义为图中好的结点的数量。一个结点 $v$ 是好的，当且仅当令 $d^+(v)$ 为 $v$ 所有出边的权值和，令 $d^-(v)$ 为 $v$ 所有入边的权值和，有 $|d^+(x)-d^-(x)|=1$。
> 
> 试着帮蓝找到图的最大可能可爱程度，并且给出任意一种构造方案。
> 
> 本题数据满足：$1 \leq n,m \leq 3\times10^5，1 \leq u_i,v_i \leq n，\mathbf{w_i\in\{1,2\}}$。

欧拉回路构造。

## CF1556F

> 有 $n\ (n\le14)$ 个人，两两之间会打比赛。每人有一个实力值 $a_i$，在 $i$ 与 $j$ 的比赛中， $i$ 有 $\frac {a_i}{a_i+a_j}$ 的概率获胜，其他情况则是 $j$ 获胜。$i$ 在与 $j$ 的比赛中获胜则称 $i$ 打败了 $j$。若 $i$ 打败了 $j$，$j$ 打败了 $k$，则认为 $i$ 也打败了 $k$。若 $i$ 打败了除了他自己以外的所有人，则称 $i$ 是一个 Winner（是否打败了自己不要求），注意 Winner 可能有多个。现在你需要求出 Winner 的期望数量，对 $1e9+7$ 取模。

状压。通过减去不合法的情况来转移。