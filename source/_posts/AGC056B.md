---
title: AGC056B
date: 2021/12/6
description: 　
---

给 $m$ 个二元组 $(l_i,r_i)$ ，对于一个长度为 $n$ 的排列 $p$ ，依次写下 $[l_i,r_i]$ 这个区间中最大值的下标 $x_i$ ，即：$\max(a_{l_i},a_{l_i+1},...,a_r)=a_{x_i}$ ，问能够得到多少种序列 $x$ ，答案对 $998244353$ 取模。 

$2\leq n\leq 300,1\leq m\leq \frac{n\times(n-1)}{2}$ 

尝试后发现不容易对 $x$ 直接计数，所以我们考虑对 $p$ 计数。由于有可能会有多个 $p$ 对应一个 $x$ ，所以我们约定对于多个这样的 $p$ ，只计算 $n$ 下标最小的，若有多个就只计算 $n-1$ 下标最小的，以此类推。

假设我们知道了 $p$ 中 $n$ 的位置 $x$ ，容易得知，所有跨越 $x$ 的区间的答案都是 $n$ ，且左右变成了两个相互独立的问题。对于右半部分 $[x+1,n]$ 是一个和原问题完全等价的问题，但左半部分 $[1,x-1]$ 不是。注意到我们先前提到的约定，左半部分的最大值与 $n$ 没有被同一个限制覆盖，那么把这两个值交换 $x$ 序列不会发生任何改变，且 $n$ 的位置更靠前了。故只有当左半部分的最大值和 $n$ 被同一个区间覆盖的方案才合法。

故我们设 $dp(l,r,x)$ 表示仅考虑区间 $[l,r]$ 和完全被包含在其中的限制，最大值在 $x$ 处的方案数。考虑转移，假设 $y$ 是这个区间中最小的点满足 $y,x$ 被同一个限制所覆盖，则有转移：
$$
dp(l,r,x)\leftarrow \sum_{t=y}^{x-1}{dp(l,x-1,t)}\times \sum_{t=x+1}^{r}{dp(x+1,r,t)}
$$
首先 $y$ 是可以预处理的，再使用后缀和优化，就是 $O(n^3)$ 的。