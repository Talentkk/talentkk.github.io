---
title: CF1572F
date: 2021/12/14
description: 　
---

有 $n$ 座城市排成一排，第 $i$ 个城市的广播站有高度 $h_i$ 和范围 $w_i$ ，可以被它广播到的城市 $j$ 必须满足：

+ $i\leq j\leq w_i$
+ 对任意 $i<k\leq j$ ，有 $h_k<h_i$

初始时 $w_i=i,h_i=0$ ，现在有 $q$ 次事件，对于第 $i$ 次事件是以下两种之一：

+ 对城市 $x$ 的广播站进行重建：$h_x=i,w_x=y$ 。
+ 询问 $\sum_{i=l}^{r}{b_i}$ ，其中 $b_i$ 表示 $i$ 被多少广播站广播。

$1\leq n,q\leq 2\times 10^5$

由于 $i$ 可以广播到的一定是一段连续的区间，所以设 $a_i$ 表示此时 $i$ 可以广播 $[i,a_i]$ 。考虑同时维护 $a_i$ 和 $b_i$ 。

当进行一次修改操作时，对 $a_i$ 的变化是：

+ $a_i=y$
+ 对 $[1,i-1]$ 这个区间与 $i-1$ 取 $\min$ 。

这是可以用 `segment tree bits` 维护的。

由于有 $b_i=\sum_{j=1}^{i}{[a_j\geq i]}$ ，所以可以用另一棵支持区间修改的线段树维护 $b$ ，并在 $a$ 被修改时对应操作。

时间复杂度 $O(n\times \log(n)^2)$ 。