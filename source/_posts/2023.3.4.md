---
title: 一些做题
date: 2023/3/4
description: 　
---

P4227

> 平面上有 $n$ 个钉子，$m$ 组询问。每次询问给出一条一端固定，一端可移动的绳子。现在捏着这个绳子的端点顺时针移动，并保证时刻紧绷，问这个绳子的圆心会切换多少次。
> 
> $1\leq n,m\leq 500,T\leq 10$

一眼模拟。

考虑如何暴力模拟。预先处理一下分别以每个点为中心，其它点分别按照极角排序的结果。模拟时记录一下上一步的斜率，然后在以当前点为中心的极角排序的序列中，从这个斜率开始顺次找到第一个满足条件的钉子，这样每走一步是 $O(n)$ ，总时间是 $O(nc)$ ，$c$ 是答案。

注意到如果当前形成了循环，走多次的代价可以直接计算。由于每次循环完毕后 $l$ 会减半，所以时间复杂度变为 $O(n^2\log l)$ 。

每次找下一个钉子的过程也可以并查集优化，因为如果遍历到的点不满足条件，那么以后也不会满足条件，时间复杂度 $O(n^2)$ 。

## P4228

> $n$ 个点的树，初始时只有 $1$ 号点，一枚棋子也在 $1$ 号点。现在要依次加入 $[2,n]$ 的节点，加入一个结点需要满足它的父亲已经加入过，然后棋子会沿着新加入节点移动一步。求出棋子最终可能在哪些节点。
> 
> $n\leq 10^5,T\leq 20$

换根 dp

m-sea.blog.luogu.org/solution-p4228

## P4229

> 长度为 $n$ 的序列，值域为 $[1,m]$ 。$q$ 组限制 $(l,r,x)$ ，表示 $[l,r]$ 中的最大值恰好为 $x$ 。求序列的方案数对 $998244353$ 取模。
> 
> $n,m\leq 9\times 10^8,q\leq 500$

把所有限制从小到大，相同的一起考虑，dp 即可。

P7431

> 给出 $a_1,a_2,...,a_n$ ，对于每个 $k\in[1,n]$ 求 $\sum_{i}{a_i^k}$ ，答案对 $998244353$ 取模。

简单生成函数。

www.luogu.com.cn/blog/Peterprpr/p7431-thupc2017-xiao-l-di-ji-suan-ti-ji-lu

## AGC003E

> 一串数，初始为 $1\sim n$，现在给 $Q$ 个操作，每次操作把数组长度变为 $q_i$，新增的数为上一个操作后的数组的重复。问 $Q$ 次操作后 $1\sim n$ 每个数出现了多少次。

递归解决问题。

www.luogu.com.cn/blog/Ebola-Emperor/solution-at2005

## AGC004E

> 有一个 $n\times m$ 的棋盘，上面要么是空的，要么有一个机器人，要么是一个出口（整个地图只有一个出口）。每次可以命令所有机器人向上下左右中的某个方向移动一格，如果它超出了棋盘的边界就会消失。如果它到了出口的位置就会被你救下(并且从棋盘上消失)。求你能够救下的机器人的最大值。
> 
> $1\leq n,m\leq 100$

比较奇妙的 dp 。

走了若干步以后，某些机器人可能就出去了。但是无论如何走，出去的机器人只和当前移动到的最左、最右、最上、最下有关。于是对于任何一种方案，我们都可以根据这四个值的变化，把它分成若干个阶段，每个阶段中显然应该把能走的点都走了更优，于是就可以 dp 了。

## AGC010D

> 黑板上写着 $N$ 个整数。第 $i$ 个整数是 $A_i$ ，它们的最大公约数为 $1$ 。
> 
> 高桥君和青木君将使用这些数来玩一个游戏。高桥君在这个游戏中是先手，他们将轮流进行以下操作（以下两步相当于一次操作）：
> 
> - 选择黑板中大于 $1$ 的一个数，将其减 $1$ 。
> - 此后，将黑板上所有数全部除以所有数的最大公约数。
> 
> 当黑板上的数全部为 $1$ 时，不能再进行操作的人就失败了。两人都选择最好的方式行动，请求出哪边会最终胜利。
> 
> $1 \leq N \leq 10^5$
> 
> $1 \leq A_i \leq 10^9$
> 
> 从 $A_1$ 到 $A_N$ 的所有数的最大公约数为 $1$ 。

从奇偶性考虑博弈问题。

## AGC005E

> 现在 A 和 B 在玩游戏，游戏是在两棵树上进行的，A 在树 $a$ 上的点 $x$，B 在树 $b$ 上的点 $y$，两棵树上的点的编号是相同的，只是连边方式不同。
> 
> 对于奇数轮，A 可以选择走到它当前在树 $a$ 上的点的相邻节点，或者在原地不动，对于偶数轮则是 B 进行选择，当两个人到达编号相同的点时，游戏结束。
> 
> 现在 A 想最大化游戏轮数，B 想最小化游戏轮数。问游戏的轮数，如果可以进行无限轮游戏，请输出 $-1$。
> 
> $2\leq n\leq 2\times 10^5$

从有解的限制条件开始考虑。

## AGC005F

> 给定一棵无根树，定义 $f(i)$，对于所有大小为 $i$ 的点集，求出能够包含它的最小连通块大小之和。对于 $i=1 \to n$ 的所有 $i$，求出 $f(i)$。
> 
> $n\leq 2\times 10^5$

把大小之和转化为每个点的贡献之和。

## ZR1221

> 给定一棵 $n$ 个点的树，$1$ 号点是根。定义 $f(x)=\sum_{i\leq j,\operatorname{lca}(i,j)=x}{w_i+w_j}$ 。
> 
> 要支持两种操作：
> 
> - `x v` ：所有 $x$ 子树内和 $x$ 距离不超过 $2$ 的点，$w_x=w_x+v$ 。
>   
> - `x` ：查询 $f(x)$ 。
>   
> 
> $1\leq n,q\leq 3\times 10^5$

很具有启发意义。

用树链剖分来平衡树高暴力和度数暴力。

## AGC006C

> 有 $n$ 个数 $x_i$ ，进行 $m$ 次操作，每次操作给出 $a_i$ ，表示 $x_{a_i}$ 将等概率地变成 $2x_{a_{i-1}}-x_{a_i}$ 和 $2x_{a_{i+1}}-x_{a_i}$ 。这样的操作将进行 $k$ 轮，问最终每个数的期望。
> 
> $n,m\leq 10^5,k\leq 10^{18}$

差分

## AGC006E

巧妙结论题，从奇偶性入手。

## AGC007C

> 在一条直线上有 $N$ 个球和 $N+1$ 个洞。记每个球与相邻的洞的距离为 $d_i \left( 1 \leq i \leq 2 \times N \right)$ 且 $d_{i + 1} - d_i = x$
> 
> 要将 $N$ 个球均推入洞中。当球滚过洞时，如果洞中还没有球，球将掉入洞中。否则，球将继续滚动。
> 
> 每次会随机选择任一未进洞的球，并随机选择一个方向推球。
> 
> 给定 $N, d_1, x$ ，求出在不发生碰撞的情况下，每个球移动距离的期望（误差小于 $10^{-9}$ ）
> 
> - $1\leq N\leq 200000$
> - $1\leq d_1\leq 100$
> - $0\leq x\leq 100$

维护每个状态中变量的期望，并寻找规律。

## AGC007E

> 一颗 $n$ 个节点的二叉树，每个节点要么有两个儿子要么没有儿子。边有边权。
> 
> 你从 $1$ 号节点出发，走到一个叶子节点。然后每一天，你可以从当前点走到另一个叶子。最后回到 $1$ 号节点，要求到过所有叶子并且每条边经过**恰好两次**。
> 
> 每天的路费是你走过的路径上的边权和，你的公司会为你报销大部分路费，除了你旅行中所用路费最高的，行走路线是**从叶子到叶子**的那一天的路费。
> 
> 求你自己最少要付多少路费？

从最优性出发简化状态，得到类似启发式合并的复杂度。

## AGC008E

> 给定正整数 $n$ 和一个长度为 $n$ 的序列 $a$，问有多少长度为 $n$ 的排列 $p$，满足对于任意 $i$ 有 $p_i=a_i$ 或 $p_{p_i}=a_i$。
> 
> 答案对 $10^9+7$ 取模。
> 
> $n \leq 10^5$。

数形结合。将统计排列转化为统计图。

## P7213

> 他发现了一行古代石柱的废墟及一份古代文献。
> 
> 古代文献上的记载如下：
> 
> - 刚建造完成的时候，有 $2\times N$ 个石柱，对于 $1\le k\le N$ 均有两个石柱高度为 $k$，同时记第 $i$ 个石柱的高度为 $h_i$。
> - 会发生 $N$ 次地震，每次地震会使一些石柱的高度 $-1$，其他石柱高度不变。
> - 石柱 $i$ 地震时高度不变，当且仅当 $h_i\ge 1$ 并且对于 $j>i$ 都要有 $h_i\not=h_j$
> - $N$ 次地震后，恰好只剩下了 $N$ 个石柱。
> 
> 现在 JOI 教授找出了仅存的 $N$ 个石柱的位置 $A_1,A_2,\ldots,A_N$，他想让你求出，最初 $2\times N$ 个石柱高度的修建方案数 $\bmod~10^9+7$ 的值。
> 
> $1\leq N\leq 600$

神仙 dp 题。一种代价后算的技巧。