---
title: CF1214G
date: 2021/12/15
description: 　
---

有一个 $n\times m$ 的矩阵 $M$ ，其元素值为 $0$ 或 $1$ ，初始所有元素都为 $0$ 。有 $q$ 次操作，每次将翻转第 $a$ 行的 $l$ 列至 $r$ 列间的所有元素。每次操作结束后，要求输出四元组 $x_1,y_1,x_2,y_2$ 满足：

+ $1\leq x_1<x_2\leq n,1\leq y_1<y_2\leq m$ 
+ $M(x_1,y1)=M(x_2,y_2)\neq M(x_1,y_2)=M(x_2,y_1)$ 

若存在给出方案，不存在输出 $-1$ 。

$1\leq n,m\leq 2000,1\leq q\leq 500000$

我们用集合 $S_i$ 表示第 $i$ 行有哪些位置是 $1$ 。现在固定两行 $i,j$ ，若它们之间不存在答案，则有 $S_i\subset S_j$ 或 $S_j\subset S_i$ ，注意到这样的性质是很强的。假设此时的矩阵中没有任何答案，我们将所有 $S_i$ 按照集合大小从小到大排序后，对于相邻的两个集合，必然有前面的是后面的子集。

受到刚才的启发，我们发现，若矩阵中存在一组方案，则对于排好序的集合中，必然有两个**相邻的集合**不满足包含关系。也就是说，假设排好序的集合是 $S_{p_1},S_{p_2},...,S_{p_n}$ ，则我们只用考虑 $(p_1,p_2),(p_2,p_3),...,(p_{n-1},p_n)$ 这些相邻行之间的方案。

我们用 `bitset` 来维护集合 $S_i$ ，并用 `multiset` 来维护排好序的集合，在 `multiset` 插入或删除元素时，可以方便地维护**有哪些相邻的集合不满足包含关系**，也就是有哪些“行对”满足答案。

时间复杂度 $O(q\times \frac{m}{w}+q\times \log(n))$ 。