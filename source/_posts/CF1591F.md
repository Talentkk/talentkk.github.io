---
title: CF1591F
date: 2021/12/14
description: 　
---

给出长为 $n$ 的数组 $a$ 。求有多少长度为 $n$ 的序列 $b$ 满足：

+ $1\leq b_i\leq a_i$
+ $b_i\neq b_{i+1}$

答案对 $998244353$ 取模。

$1\leq n\leq 2\times 10^5$

考虑容斥，一个限制不合法意味着 $b_i=b_{i+1}$ 。

暴力的方法是，枚举不满足的限制的集合。若把 $b_i=b_{i+1}$ 看成在 $i$ 和 $i+1$ 连边，根据集合中的限制会形成若干个线段。对于每个线段 $[l,r]$ 的方案数是 $\min_{i=l}^{r}{a_i}$ ，而枚举的这个集合的方案数就是每条线段方案数的乘积。

考虑用 $dp$ 来计算上述过程。设 $dp(i)$ 表示我们已经把 $[1,i]$ 分成了若干条线段 （$i$ 是一条线段的结尾）的所有方案的代价，的带容斥系数之和。显然有转移：
$$
dp(i)\leftarrow dp(j)\times \min_{k=j+1}^{i}{a_k}\times(-1)^{i-j-1}
$$
用单调栈可优化至 $O(n)$ 。