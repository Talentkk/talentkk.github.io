---
title: 2021.11.28 练习
date: 2021/11/28 
description: 　
---
## CF1614D

给一个长度为 $n$ 的序列 $a$ ，需要将这个序列重排，使得以下式子取到最大值：
$$
\sum_{i=1}^{n}{\gcd(a_1,a_2,...,a_i)}
$$
$1\leq n\leq 10^5,1\leq a_i\leq 2\times 10^7$ 

不妨设重排后 $b_i=\gcd(a_1,a_2,...,a_i)$ ，则如果有 $i$ 满足 $b_i>b_{i+1}$ ，则一定不存在 $j>i$ 满足 $b_i|a_j$ ，不然把 $a_j$ 插到前面更优，也就是说所有 $b_i$ 的倍数一定在 $i$ 之前。我们设 $dp_i$ 表示把所有 $i$ 的倍数排列的最大值，转移时，先预处理 $d_x$ 表示有多少 $a_i$ 是 $x$ 的倍数（$n\times \log(n)$），然后对于 $dp_i$ 直接从它的倍数转移过来：
$$
dp_i\leftarrow dp_{j} +(d_i-d_j)\times i
$$
分析这个转移，可能会有一些不合法的地方，因为在加入 $a_{d_j+1}$ 到 $a_{d_i}$ 这些数的时候，它们的 $b$ 值不一定是 $i$ （可能是 $i$ 的倍数），那这样加上的贡献就不对了。但是会发现实际是一种更劣的转移，会被更优的转移覆盖掉，所以可以保证正确性。但是这样的复杂度不能通过。考虑优化后面的 $dp$ 过程，发现一个数不用从它的所有倍数转移过来，只用从它的质数倍转移过来即可。虽然这样的复杂度瓶颈在预处理 $d_x$ ，但可以通过。

## CF1614E

给定 $n$ 天的气温 $T_i$ ，设第 $i$ 天温度为 $P$ ，则第 $i+1$ 天的温度为：

- $P+1 ( P<T_i)$
- $P-1 ( P>T_i )$
- $P ( P=T_i )$

对第 $i$ 天有 $k_i$ 个询问，问若第 $0$ 天的温度为 $x$ ，那么第 $i$ 天的温度是多少。

强制在线。

$1\leq n\leq 2\times 10^5, \sum k_i\leq 2\times 10^5,0\leq T_i,x\leq 10^9$

若设 $f(x)$ 表示初始温度为 $x$ 时，当前的温度，可以发现 $f(x)$ 是单调的。

所以直接用动态开点线段树维护 $f(x)$ ，对于每次的修改操作，直接二分出最大的 $x$ 满足 $f(x)<T_i$ 和最小的 $y$ 满足 $f(x)>T_i$ ，然后对 $[0,x]$ 区间加一， $[y,10^9]$ 区间减一即可。

## ABC229G

给定一个长度为 $n$ 只含字符 `Y` 和 `.` 的字符串。你可以进行最多 $k$ 次交换两个相邻的字符的操作，问交换完后，可能最长的由 `Y` 组成的连续段有多长。

$1\leq n\leq 2\times 10^5,1\leq k\leq 10^{12}$

考虑初始字符串和最终字符串，`Y` 的相对顺序肯定不变，所以不会有一次操作交换两个 `Y` 。假设第 $i$ 个 `Y` 的位置是 $p_i$ ，如果我们写出一个长度为 `Y` 的个数的序列 $b$ ，其中 $b_i=p_i-i$ 。那么问题就转化为，要对 $b$ 序列进行最多 $k$ 次给某个数 `+1` 或 `-1` 的操作，使得最终 $b$ 序列中某个数 $x$ 的出现的数量尽可能大。因为 $b$ 序列一直是不降的，所以 $b_i=x$ 的位置一定是某个连续段。对于一个连续段 $[l,r]$ 如果要把其中的数都变成一个数，那么这样的代价是:
$$
\sum_{i=l}^{r}{|b_i-x|}
$$
 根据初一课本知识，当 $x$ 取 $b_l,b_{l+1},...,b_r$ 的中位数时代价最小。然后直接 `two pointer` 扫一遍即可。时间复杂度 $O(n)$ 。